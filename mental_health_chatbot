!pip install pandas scikit-learn termcolor
# 1. Imports and Setup
import pandas as pd
import numpy as np
import random
from sklearn.model_selection import train_test_split
from sklearn.pipeline import make_pipeline
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.naive_bayes import MultinomialNB
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import classification_report
from termcolor import cprint
# 2. Load and Train Emotion Detection Model
print("\nðŸ“‚ Loading Emotions Dataset...")
try:
    df = pd.read_csv('emotions.csv')  # Ensure this file exists
except FileNotFoundError:
    print("â— Error: 'emotions.csv' not found. Please provide the dataset.")
    exit()
# Rename columns for consistency
df.rename(columns={'label': 'emotion', 'text': 'text'}, inplace=True, errors='ignore')
# Check if dataset has required columns
if 'text' not in df.columns or 'emotion' not in df.columns:
    print("â— Error: Dataset must have 'text' and 'emotion' columns.")
    exit()
# Balance the dataset
min_count = df['emotion'].value_counts().min()
df_balanced = df.groupby('emotion').apply(lambda x: x.sample(min_count, random_state=42)).reset_index(drop=True)
# Split and train model
X_train, X_test, y_train, y_test = train_test_split(
    df_balanced['text'], df_balanced['emotion'], test_size=0.2, random_state=42
)
emotion_model = make_pipeline(CountVectorizer(), MultinomialNB())
emotion_model.fit(X_train, y_train)
# Evaluation
print("\nâœ… Emotion Model Trained. Evaluation:")
print(classification_report(y_test, emotion_model.predict(X_test)))
# 3. Train Depression Prediction Model
print("\nðŸ“‚ Loading Depression Dataset...")
depression_data = {
    'anxiety': [3, 1, 2, 0, 3, 1, 2, 0, 3, 2],
    'sleep_issues': [2, 1, 2, 0, 3, 2, 1, 0, 3, 3],
    'loss_of_interest': [3, 0, 1, 0, 2, 1, 3, 0, 2, 2],
    'tiredness': [3, 1, 2, 0, 3, 1, 3, 1, 3, 2],
    'depression': [1, 0, 1, 0, 1, 0, 1, 0, 1, 1]
}
df_depress = pd.DataFrame(depression_data)
X_dep = df_depress.drop(columns='depression')
y_dep = df_depress['depression']
X_train_d, X_test_d, y_train_d, y_test_d = train_test_split(X_dep, y_dep, test_size=0.2, random_state=42)
depression_model = LogisticRegression(max_iter=1000)
depression_model.fit(X_train_d, y_train_d)
# 4. Start Combined Chatbot
print("\nðŸ§  Welcome to the Mental Health Self-Check Chatbot!")
print("Weâ€™ll start with a short questionnaire, then move to chat. (Answer 0 = Never, 1=sometime,2=often,3 = Always)")
# Questionnaire
questions = [
    "How often do you feel anxious or nervous?",
    "How often do you have trouble sleeping?",
    "How often do you lose interest in things you used to enjoy?",
    "How often do you feel tired or low on energy?"
]
responses = []
for q in questions:
    while True:
        try:
            ans = int(input(f"{q} [0-3]: "))
            if ans in [0, 1, 2, 3]:
                responses.append(ans)
                break
            else:
                print("â— Please enter a number between 0 and 3.")
        except ValueError:
            print("â— Invalid input. Please enter a number.")
# Depression Prediction
input_data = np.array([responses])
prediction = depression_model.predict(input_data)[0]
confidence = depression_model.predict_proba(input_data)[0][prediction] * 100
# Results
print("\nðŸ“Š Results:")
if prediction == 1:
    cprint("âš ï¸ You may be showing signs of depression.", "red")
    print(f"Confidence: {confidence:.2f}%")
    tips = [
        "ðŸ§˜ Try practicing mindfulness or meditation.",
        "ðŸ“ž Consider talking to a counselor or therapist.",
        "ðŸš¶ Take short daily walks to clear your mind.",
        "ðŸ““ Write down your thoughts in a journal."
    ]
    print("\nHere are a few tips that might help:")
    for tip in random.sample(tips, 2):
        print(" -", tip)
else:
    cprint("âœ… No strong signs of depression.", "green")
    print(f"Confidence: {confidence:.2f}%")
    print("Keep taking care of yourself! ðŸŒ¿")
# 5. Emotion Chatbot Loop
print("\nðŸ—¨ï¸ Let's talk! Tell me how you're feeling (type 'exit' to quit).")
emotion_map = {
    0: "sad",
    1: "happy",
    3:"love",
    3 :"anger",
    4:"fear",
    5:"surprise",
    6:"unknown"
        # Add more mappings if your dataset uses other numbers (e.g., 2: "angry")
}
responses = {
    "happy": [
        "That's awesome to hear! What's got you smiling today?",
        "Love the positivity! What's making you happy?",
        "Yay, happy vibes! Want to share more?"
    ],
    "sad": [
        "I'm sorry you're feeling down. Want to talk about what's going on?",
        "It's okay to feel sad sometimes. I'm hereâ€”want to share more?",
        "I hear you. Feeling sad can be tough. Want to tell me more?"
    ],
    "love": [
        "That's wonderful! Love is such a powerful feeling.",
        "Love brings warmth and joy. Care to share more about it?",
        "Itâ€™s great to feel connectedâ€”tell me more about what youâ€™re experiencing."
    ],
    "anger": [
        "It's okay to feel angry. Maybe a walk or journaling could help release some of it.",
        "Anger is a normal feeling. How about trying some deep breathing?",
        "Sometimes, talking about what's making you angry helps. Want to share?"
    ],
    "fear": [
        "It's okay to feel scared sometimes. You're not alone in this.",
        "Fear can be overwhelming, but you can get through it. I'm here if you need me.",
        "Let's take things one step at a time. What are you most afraid of right now?"
    ],
    "surprise": [
        "That sounds surprising! What happened?",
        "Surprises can be exciting or shocking. Want to tell me more?",
        "Wow! Thatâ€™s unexpectedâ€”do you want to share what surprised you?"
    ],
    "unknown": [
        "I'm here for you. Can you tell me more about how you're feeling?",
        "Thanks for sharing. Want to dive deeper into how you're feeling?",
        "I'm listeningâ€”tell me more about what's on your mind."
    ]
}
# Track previous inputs to avoid repetitive responses
previous_inputs = []
previous_emotion = None
previous_response = None
repeat_count = 0
max_repeats = 2
while True:
    user_input = input("You: ").strip().lower()
    if user_input == 'exit':
        print("Chatbot: Take care! I'm always here if you need to talk. â¤ï¸")
        break
    if not user_input:
        print("Chatbot: It seems you didn't say anything. How are you feeling?")
        continue
    # Handle special cases for "yes" and "no"
    if user_input == "yes":
        if previous_response and ("share" in previous_response.lower() or "talk" in previous_response.lower()):
            response = "Great, I'm here to listen. What's on your mind?"
        else:
            response = "Cool, can you tell me more about how you're feeling?"
        print(f"(Detected Input: {user_input})")
        previous_inputs.append(user_input)
        previous_emotion = None  # Reset emotion for neutral input
        previous_response = response
        print(f"Chatbot: {response}")
        continue
    elif user_input == "no":
        if previous_response and ("share" in previous_response.lower() or "talk" in previous_response.lower()):
            response = "That's okay, I'm here whenever you're ready to talk."
        else:
            response = "Alright, i with you "
        print(f"(Detected Input: {user_input})")
        previous_inputs.append(user_input)
        previous_emotion = None  # Reset emotion for neutral input
        previous_response = response
        print(f"Chatbot: {response}")
        continue
    # Predict emotion for other inputs
    predicted_emotion_num = emotion_model.predict([user_input])[0]
    predicted_emotion = emotion_map.get(predicted_emotion_num, "unknown")
    print(f"(Detected Emotion: {predicted_emotion_num} -> {predicted_emotion})")
    # Choose response list based on emotion
    response_list = responses.get(predicted_emotion, responses["unknown"])
    # Check for repetitive input
    if user_input in previous_inputs and predicted_emotion == previous_emotion:
        repeat_count += 1
        if repeat_count >= max_repeats:
            response = "It seems you're feeling the same way. Maybe there's something specific you'd like to share or explore?"
        else:
            # Pick a random response, avoiding the previous one if possible
            available_responses = [r for r in response_list if r != previous_response]
            response = random.choice(available_responses or response_list)
    else:
        repeat_count = 0
        response = random.choice(response_list)
    # Update tracking
    previous_inputs.append(user_input)
    previous_emotion = predicted_emotion
    previous_response = response
    if len(previous_inputs) > 5:  # Limit history
        previous_inputs.pop(0)
    print(f"Chatbot: {response}")
